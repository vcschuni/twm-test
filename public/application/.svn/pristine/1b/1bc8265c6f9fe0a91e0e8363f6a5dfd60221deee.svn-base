class ZoomToUTM {
	
	/**
	 * Function: constructor
	 * @param () none
	 * @returns () nothing
	 * Function that initializes the class
	 */
	constructor() {
		this.name = "ZoomToUTM";
		this.version = 1.0;
		this.author = "Peter Spry";
		this.contentFile = "application/plugins/ZoomToUTM/utmTemplate.html"; // UI for template
		this.windowContent = $("<div id='utmForm'/>"); // placeholder for template
		this.pcfg = getPluginConfig(this.name);
		this.buttonLocatedRight = (this.pcfg.buttonLocatedRight) ? this.pcfg.buttonLocatedRight : true;
		this.buttonLocatedTop = (this.pcfg.buttonLocatedTop) ? this.pcfg.buttonLocatedTop : false;
		this.buttonLocationOffset = (this.pcfg.buttonLocationOffset) ? this.pcfg.buttonLocationOffset : "10em";				
		this.addPlugin();
	}
	
    /**
	 * Function: zoomToFormUTM
	 * @param () none
	 * @returns () none
	 * Function that converts a UTM X,Y and Zone to Map Point and zooms to it
	 */	
	zoomToFormUTM() {
		var EPSG = $('input[name=UTM]:checked', '.utm-check').val();
		var utmPointGeometry = new ol.geom.Point([Number($("#utmX").val()),Number($("#utmY").val())]);
		var pointInMapCoords = utmPointGeometry.transform(EPSG, app.map.getView().getProjection().getCode());
		var pointFeature = new ol.Feature({geometry:pointInMapCoords});
		zoomToFeature(pointFeature);
	}


	
	/**
	 * Function: addPlugin
	 * @param () none
	 * @returns () nothing
	 * Function that adds the plugin tab to the sidebar
	 */
	addPlugin() {
        // Load in the button icon
		var iconSrc = '<img src="./application/plugins/ZoomToUTM/img/utmIcon.png" width="15" height="15">';
		
        // Create the ZoomToUTM button
        var button = document.createElement('button');
        button.id = "sv-ZoomToUTM-btn";
		button.innerHTML = iconSrc; 

		
        // Create the ZoomToUTM location div
		var element = document.createElement('div');
		element.title = "Zoom to UTM";
		element.id = "ZoomToUTM-btn";
		element.className = 'ZoomToUTM-btn ol-control';
		if (this.buttonLocatedTop) {
			element.style.top = this.buttonLocationOffset;
		} else {
			element.style.bottom = this.buttonLocationOffset;
		}
		if (this.buttonLocatedRight) {
			element.style.right = '.5em';
		} else {
			element.style.left = '.5em';
		}
		element.appendChild(button);
		
		// Create a new open layers control for the ZoomToUTM location button
		var ZoomToUTMControl = new ol.control.Control({
			element: element    
		});
		
		// Add the new control to the map
		app.map.addControl(ZoomToUTMControl);
		
		this.windowContent = `
		<center>
<div class="utm-check">
  <input class="utm-check-input" type="radio" name="UTM" id="utm7N" value="EPSG:26907">
  <label class="utm-check-label" for="utm7N">
    UTM 8N
  </label>
</div>		
<div class="utm-check">
  <input class="utm-check-input" type="radio" name="UTM" id="utm8N" value="EPSG:26908">
  <label class="utm-check-label" for="utm8N">
    UTM 8N
  </label>
</div>
<div class="utm-check">
  <input class="utm-check-input" type="radio" name="UTM" id="utm9N"  value="EPSG:26909">
  <label class="utm-check-label" for="utm9N">
    UTM 9N
  </label>
</div>
<div class="utm-check">
  <input class="utm-check-input" type="radio" name="UTM" id="utm10N" checked value="EPSG:26910">
  <label class="utm-check-label" for="utm10N">
    UTM 10N
  </label>
</div>
<div class="utm-check">
  <input class="utm-check-input" type="radio" name="UTM" id="utm11N"  value="EPSG:26911">
  <label class="utm-check-label" for="utm11N">
    UTM 11N
  </label>
</div>

<div class="input-group mb-3">
  <span class="input-group-text">X (Easting)</span>
  <input id="utmX" type="text" class="form-control utm-input" placeholder="example: 515300" style="background-color:pink;" aria-label="X (Easting)" aria-describedby="utmX" required>
</div>
<div class="input-group mb-3">
  <span class="input-group-text utm-input" >Y (Northing)</span>
  <input id="utmY" type="text" class="form-control utm-input" placeholder="example: 5972000" style="background-color:pink;" aria-label="Y (Northing)" aria-describedby="utmY" required>
</div>

<button value="Zoom" class="btn btn-primary disabled" id="utmZoom-btn">Zoom</button>

</center>
`;		
		
		// Add the click event to the ZoomToUTM  button
		$("#ZoomToUTM-btn").click(function() {
			console.log("opening zoom tool");
			app.plugins.MultiFloatingWindow.open("utm", "Zoom to UTM Coordinate", app.plugins.ZoomToUTM.windowContent, 350, 250, 'left');
			$("#utm-empty").hide();
			$("#utm-numeric").hide();
			$("#utmZoom-btn").click(function() {
				app.plugins.ZoomToUTM.zoomToFormUTM(); 
			});
			$(".utm-input").on( "blur", function() {
				if ($.isNumeric($(this).val())) {
					$(this).css({"background-color": "white"}); 
				} else {
					$(this).css({"background-color": "pink"}); 
				}
				if ($.isNumeric($("#utmX").val()) && $.isNumeric($("#utmY").val())) {
					$("#utmZoom-btn").removeClass("disabled");
				} else {
					if (!($("#utmZoom-btn").hasClass("disabled"))) {
						$("#utmZoom-btn").addClass("disabled");
					}
				}
			} );
		});
		// Log success
		logger("INFO",  "ZoomToUTM: Plugin successfully loaded");


	}
}